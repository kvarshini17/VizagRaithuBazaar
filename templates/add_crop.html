{% extends "base.html" %}

{% block title %}Add Crop - VizagRaithuBazaar{% endblock %}

{% block content %}
<div class="container my-4">
    <div class="row">
        <div class="col-md-8 mx-auto">
            <!-- MSP KEY FEATURE BANNER -->
            <div class="alert alert-success alert-dismissible fade show shadow-sm" role="alert">
                <h5 class="alert-heading">
                    <i class="bi bi-graph-up-arrow"></i> 
                    {% if lang == 'te' %}
                        MSP ‡∞Æ‡∞æ‡∞∞‡±ç‡∞ó‡∞¶‡∞∞‡±ç‡∞∂‡∞ï‡∞§‡±ç‡∞µ‡∞Ç‡∞§‡±ã ‡∞Æ‡±Ä ‡∞™‡∞Ç‡∞ü‡∞≤‡∞®‡±Å ‡∞ú‡∞æ‡∞¨‡∞ø‡∞§‡∞æ ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø
                    {% else %}
                        List Your Crops with MSP Guidance
                    {% endif %}
                </h5>
                <p class="mb-0">
                    {% if lang == 'te' %}
                        ‡∞Æ‡±á‡∞Æ‡±Å ‡∞Æ‡±Ä ‡∞ß‡∞∞ ‡∞Æ‡∞∞‡∞ø‡∞Ø‡±Å ‡∞™‡∞∞‡∞ø‡∞Æ‡∞æ‡∞£‡∞æ‡∞®‡±ç‡∞®‡∞ø MSP ‡∞§‡±ã ‡∞™‡±ã‡∞≤‡±ç‡∞ö‡∞ø, ‡∞Æ‡∞Ç‡∞ö‡∞ø ‡∞ß‡∞∞ ‡∞™‡±ä‡∞Ç‡∞¶‡∞°‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞Æ‡±Ä‡∞ï‡±Å ‡∞∏‡∞π‡∞æ‡∞Ø‡∞Ç ‡∞ö‡±á‡∞∏‡±ç‡∞§‡∞æ‡∞Æ‡±Å
                    {% else %}
                        We compare your price and quantity with MSP to help you get fair returns
                    {% endif %}
                </p>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>

            <div class="card shadow-lg">
                <div class="card-header bg-success text-white">
                    <h3 class="mb-0">
                        <i class="bi bi-plus-circle"></i> {{ t.add_crop if t else 'Add Crop' }}
                    </h3>
                    <p class="mb-0">{{ 'List your crop for consumers to purchase' if lang == 'en' else '‡∞µ‡∞ø‡∞®‡∞ø‡∞Ø‡±ã‡∞ó‡∞¶‡∞æ‡∞∞‡±Å‡∞≤‡±Å ‡∞ï‡±ä‡∞®‡±Å‡∞ó‡±ã‡∞≤‡±Å ‡∞ö‡±á‡∞Ø‡∞°‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞Æ‡±Ä ‡∞™‡∞Ç‡∞ü‡∞®‡±Å ‡∞ú‡∞æ‡∞¨‡∞ø‡∞§‡∞æ ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø' }}</p>
                </div>
                
                <div class="card-body p-4">
                    <!-- MSP INFO ALERT - PROMINENT -->
                    <div id="msp-info-alert" class="alert alert-info border-info shadow-sm" style="display: none; border-width: 3px;">
                        <div class="row align-items-center">
                            <div class="col-auto">
                                <i class="bi bi-info-circle-fill" style="font-size: 3rem; color: #0dcaf0;"></i>
                            </div>
                            <div class="col">
                                <h5 class="mb-2" id="msp-crop-name" style="font-weight: 700;"></h5>
                                <div id="msp-info-text" class="mb-2"></div>
                                <div id="msp-quantity-info" style="display: none;">
                                    <hr class="my-2">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <strong>{{ 'Your Quantity:' if lang == 'en' else '‡∞Æ‡±Ä ‡∞™‡∞∞‡∞ø‡∞Æ‡∞æ‡∞£‡∞Ç:' }}</strong>
                                            <span id="farmer-quantity">0</span> kg
                                        </div>
                                        <div class="col-md-6">
                                            <strong>{{ 'MSP Value:' if lang == 'en' else 'MSP ‡∞µ‡∞ø‡∞≤‡±Å‡∞µ:' }}</strong>
                                            <span id="msp-total-value" class="text-success fw-bold">‚Çπ0</span>
                                        </div>
                                    </div>
                                    <small class="text-muted d-block mt-2">
                                        {{ 'This is the minimum government guaranteed price for your entire quantity' if lang == 'en' else '‡∞á‡∞¶‡∞ø ‡∞Æ‡±Ä ‡∞Æ‡±ä‡∞§‡±ç‡∞§‡∞Ç ‡∞™‡∞∞‡∞ø‡∞Æ‡∞æ‡∞£‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞™‡±ç‡∞∞‡∞≠‡±Å‡∞§‡±ç‡∞µ‡∞Ç ‡∞π‡∞æ‡∞Æ‡±Ä ‡∞á‡∞ö‡±ç‡∞ö‡∞ø‡∞® ‡∞ï‡∞®‡±Ä‡∞∏ ‡∞ß‡∞∞' }}
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <form method="POST" action="{{ url_for('add_crop') }}">
                        <div class="mb-4">
                            <label for="crop_name" class="form-label fw-bold fs-5">
                                <i class="bi bi-basket"></i> {{ 'Crop Name' if lang == 'en' else '‡∞™‡∞Ç‡∞ü ‡∞™‡±á‡∞∞‡±Å' }} *
                            </label>
                            <input type="text" 
                                   class="form-control form-control-lg" 
                                   id="crop_name" 
                                   name="crop_name" 
                                   list="crop-suggestions"
                                   placeholder="{{ 'e.g., Rice, Wheat, Tomato' if lang == 'en' else '‡∞â‡∞¶‡∞æ., ‡∞¨‡∞ø‡∞Ø‡±ç‡∞Ø‡∞Ç, ‡∞ó‡±ã‡∞ß‡±Å‡∞Æ, ‡∞ü‡∞Æ‡∞æ‡∞ü‡∞æ' }}"
                                   required>
                            <datalist id="crop-suggestions">
                                {% for crop in msp_crops %}
                                    <option value="{{ crop }}">
                                {% endfor %}
                            </datalist>
                            <div class="form-text">{{ 'Select from suggestions or enter custom crop name' if lang == 'en' else '‡∞∏‡±Ç‡∞ö‡∞®‡∞≤ ‡∞®‡±Å‡∞Ç‡∞°‡∞ø ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø ‡∞≤‡±á‡∞¶‡∞æ ‡∞Ö‡∞®‡±Å‡∞ï‡±Ç‡∞≤ ‡∞™‡∞Ç‡∞ü ‡∞™‡±á‡∞∞‡±Å ‡∞®‡∞Æ‡±ã‡∞¶‡±Å ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø' }}</div>
                        </div>

                        <div class="mb-4">
                            <label for="quantity" class="form-label fw-bold fs-5">
                                <i class="bi bi-box-seam"></i> {{ 'Quantity (kg)' if lang == 'en' else '‡∞™‡∞∞‡∞ø‡∞Æ‡∞æ‡∞£‡∞Ç (‡∞ï‡∞ø‡∞≤‡±ã)' }} *
                            </label>
                            <input type="number" 
                                   class="form-control form-control-lg" 
                                   id="quantity" 
                                   name="quantity" 
                                   step="0.1"
                                   min="0.1"
                                   placeholder="{{ 'Enter quantity in kilograms' if lang == 'en' else '‡∞ï‡∞ø‡∞≤‡±ã‡∞ó‡±ç‡∞∞‡∞æ‡∞Æ‡±Å‡∞≤‡∞≤‡±ã ‡∞™‡∞∞‡∞ø‡∞Æ‡∞æ‡∞£‡∞Ç ‡∞®‡∞Æ‡±ã‡∞¶‡±Å ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø' }}"
                                   required>
                            <div class="form-text">{{ 'Enter your available quantity first to see MSP value' if lang == 'en' else 'MSP ‡∞µ‡∞ø‡∞≤‡±Å‡∞µ ‡∞ö‡±Ç‡∞°‡∞ü‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞Æ‡±Å‡∞Ç‡∞¶‡±Å‡∞ó‡∞æ ‡∞Æ‡±Ä ‡∞Ö‡∞Ç‡∞¶‡±Å‡∞¨‡∞æ‡∞ü‡±Å‡∞≤‡±ã ‡∞â‡∞®‡±ç‡∞® ‡∞™‡∞∞‡∞ø‡∞Æ‡∞æ‡∞£‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞®‡∞Æ‡±ã‡∞¶‡±Å ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø' }}</div>
                        </div>
                        
                        <div class="mb-4">
                            <label for="price_per_kg" class="form-label fw-bold fs-5">
                                <i class="bi bi-currency-rupee"></i> {{ 'Price per kg' if lang == 'en' else '‡∞ï‡∞ø‡∞≤‡±ã ‡∞ß‡∞∞' }} *
                            </label>
                            <div class="input-group input-group-lg">
                                <span class="input-group-text">‚Çπ</span>
                                <input type="number" 
                                       class="form-control" 
                                       id="price_per_kg" 
                                       name="price_per_kg" 
                                       step="0.01"
                                       min="0.01"
                                       placeholder="{{ 'Enter price per kilogram' if lang == 'en' else '‡∞ï‡∞ø‡∞≤‡±ã‡∞ó‡±ç‡∞∞‡∞æ‡∞Æ‡±Å ‡∞ß‡∞∞ ‡∞®‡∞Æ‡±ã‡∞¶‡±Å ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø' }}"
                                       required>
                                <span class="input-group-text">/kg</span>
                            </div>
                            <div class="form-text">{{ 'Set your price (MSP comparison will show below)' if lang == 'en' else '‡∞Æ‡±Ä ‡∞ß‡∞∞‡∞®‡±Å ‡∞∏‡±Ü‡∞ü‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø (MSP ‡∞™‡±ã‡∞≤‡∞ø‡∞ï ‡∞ï‡±ç‡∞∞‡∞ø‡∞Ç‡∞¶ ‡∞ö‡±Ç‡∞™‡∞¨‡∞°‡±Å‡∞§‡±Å‡∞Ç‡∞¶‡∞ø)' }}</div>
                            
                            <!-- PRICE WARNING -->
                            <div id="price-warning" class="mt-3"></div>
                        </div>

                        <!-- TOTAL EARNINGS DISPLAY -->
                        <div id="total-earnings-display" class="alert alert-light border-primary shadow-sm mb-4" style="display: none; border-width: 3px;">
                            <div class="row align-items-center">
                                <div class="col-auto">
                                    <i class="bi bi-calculator-fill text-primary" style="font-size: 3rem;"></i>
                                </div>
                                <div class="col">
                                    <h5 class="mb-1">{{ 'Your Total Earnings' if lang == 'en' else '‡∞Æ‡±Ä ‡∞Æ‡±ä‡∞§‡±ç‡∞§‡∞Ç ‡∞Ü‡∞¶‡∞æ‡∞Ø‡∞Ç' }}</h5>
                                    <h2 class="mb-1 text-primary fw-bold" id="total-earnings-value">‚Çπ0</h2>
                                    <small class="text-muted" id="earnings-breakdown"></small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label for="location" class="form-label fw-bold fs-5">
                                <i class="bi bi-geo-alt"></i> {{ 'Location in Vizag' if lang == 'en' else '‡∞µ‡∞ø‡∞∂‡∞æ‡∞ñ‡∞™‡∞ü‡±ç‡∞®‡∞Ç‡∞≤‡±ã ‡∞∏‡±ç‡∞•‡∞æ‡∞®‡∞Ç' }} *
                            </label>
                            <select class="form-select form-select-lg" id="location" name="location" required>
                                <option value="">{{ 'Select your area/locality' if lang == 'en' else '‡∞Æ‡±Ä ‡∞™‡±ç‡∞∞‡∞æ‡∞Ç‡∞§‡∞Ç/‡∞∏‡±ç‡∞•‡∞æ‡∞®‡∞ø‡∞ï ‡∞™‡±ç‡∞∞‡∞æ‡∞Ç‡∞§‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø' }}</option>
                                <optgroup label="{{ 'Central Vizag' if lang == 'en' else '‡∞∏‡±Ü‡∞Ç‡∞ü‡±ç‡∞∞‡∞≤‡±ç ‡∞µ‡∞ø‡∞∂‡∞æ‡∞ñ‡∞™‡∞ü‡±ç‡∞®‡∞Ç' }}">
                                    <option value="Dwaraka Nagar">Dwaraka Nagar (‡∞¶‡±ç‡∞µ‡∞æ‡∞∞‡∞ï ‡∞®‡∞ó‡∞∞‡±ç)</option>
                                    <option value="MVP Colony">MVP Colony (MVP ‡∞ï‡∞æ‡∞≤‡∞®‡±Ä)</option>
                                    <option value="Siripuram">Siripuram (‡∞∏‡∞ø‡∞∞‡∞ø‡∞™‡±Å‡∞∞‡∞Ç)</option>
                                    <option value="Pandurangapuram">Pandurangapuram (‡∞™‡∞æ‡∞Ç‡∞°‡±Å‡∞∞‡∞Ç‡∞ó‡∞™‡±Å‡∞∞‡∞Ç)</option>
                                    <option value="Seethammadhara">Seethammadhara (‡∞∏‡±Ä‡∞§‡∞Æ‡±ç‡∞Æ‡∞¶‡∞æ‡∞∞)</option>
                                </optgroup>
                                <optgroup label="{{ 'North Vizag' if lang == 'en' else '‡∞â‡∞§‡±ç‡∞§‡∞∞ ‡∞µ‡∞ø‡∞∂‡∞æ‡∞ñ‡∞™‡∞ü‡±ç‡∞®‡∞Ç' }}">
                                    <option value="Gajuwaka">Gajuwaka (‡∞ó‡∞æ‡∞ú‡±Å‡∞µ‡∞æ‡∞ï)</option>
                                    <option value="Pedagantyada">Pedagantyada (‡∞™‡±Ü‡∞°‡∞ó‡∞Ç‡∞§‡±ç‡∞Ø‡∞æ‡∞°)</option>
                                    <option value="Gopalapatnam">Gopalapatnam (‡∞ó‡±ã‡∞™‡∞æ‡∞≤‡∞™‡∞ü‡±ç‡∞®‡∞Ç)</option>
                                    <option value="Anakapalle">Anakapalle (‡∞Ö‡∞®‡∞ï‡∞æ‡∞™‡∞≤‡±ç‡∞≤‡∞ø)</option>
                                    <option value="Pendurthi">Pendurthi (‡∞™‡±Ü‡∞Ç‡∞¶‡±Å‡∞∞‡±ç‡∞§‡∞ø)</option>
                                </optgroup>
                                <optgroup label="{{ 'East Vizag' if lang == 'en' else '‡∞§‡±Ç‡∞∞‡±ç‡∞™‡±Å ‡∞µ‡∞ø‡∞∂‡∞æ‡∞ñ‡∞™‡∞ü‡±ç‡∞®‡∞Ç' }}">
                                    <option value="Madhurawada">Madhurawada (‡∞Æ‡∞ß‡±Å‡∞∞‡∞µ‡∞æ‡∞°)</option>
                                    <option value="Rushikonda">Rushikonda (‡∞∞‡±Å‡∞∑‡∞ø‡∞ï‡±ä‡∞Ç‡∞°)</option>
                                    <option value="Visakha Beach Road">Visakha Beach Road (‡∞µ‡∞ø‡∞∂‡∞æ‡∞ñ ‡∞¨‡±Ä‡∞ö‡±ç ‡∞∞‡±ã‡∞°‡±ç)</option>
                                    <option value="Lawsons Bay">Lawsons Bay (‡∞≤‡∞æ‡∞∏‡∞®‡±ç‡∞∏‡±ç ‡∞¨‡±á)</option>
                                </optgroup>
                                <optgroup label="{{ 'South Vizag' if lang == 'en' else '‡∞¶‡∞ï‡±ç‡∞∑‡∞ø‡∞£ ‡∞µ‡∞ø‡∞∂‡∞æ‡∞ñ‡∞™‡∞ü‡±ç‡∞®‡∞Ç' }}">
                                    <option value="NAD Kotha Road">NAD Kotha Road (NAD ‡∞ï‡±ã‡∞§ ‡∞∞‡±ã‡∞°‡±ç)</option>
                                    <option value="Maddilapalem">Maddilapalem (‡∞Æ‡∞¶‡±ç‡∞¶‡∞ø‡∞≤‡∞™‡∞æ‡∞≤‡±Ü‡∞Ç)</option>
                                    <option value="One Town">One Town (‡∞µ‡∞®‡±ç ‡∞ü‡±å‡∞®‡±ç)</option>
                                    <option value="Jagadamba">Jagadamba (‡∞ú‡∞ó‡∞¶‡∞Ç‡∞¨)</option>
                                </optgroup>
                                <optgroup label="{{ 'West Vizag' if lang == 'en' else '‡∞™‡∞∂‡±ç‡∞ö‡∞ø‡∞Æ ‡∞µ‡∞ø‡∞∂‡∞æ‡∞ñ‡∞™‡∞ü‡±ç‡∞®‡∞Ç' }}">
                                    <option value="Kommadi">Kommadi (‡∞ï‡±ä‡∞Æ‡±ç‡∞Æ‡∞°‡∞ø)</option>
                                    <option value="Madhurapudi">Madhurapudi (‡∞Æ‡∞ß‡±Å‡∞∞‡∞™‡±Ç‡∞°‡∞ø)</option>
                                    <option value="Akkayyapalem">Akkayyapalem (‡∞Ö‡∞ï‡±ç‡∞ï‡∞Ø‡±ç‡∞Ø‡∞™‡∞æ‡∞≤‡±Ü‡∞Ç)</option>
                                </optgroup>
                                <optgroup label="{{ 'Suburban Areas' if lang == 'en' else '‡∞∂‡∞ø‡∞µ‡∞æ‡∞∞‡±ç‡∞≤ ‡∞™‡±ç‡∞∞‡∞æ‡∞Ç‡∞§‡∞æ‡∞≤‡±Å' }}">
                                    <option value="Bheemunipatnam">Bheemunipatnam (‡∞≠‡±Ä‡∞Æ‡±Å‡∞®‡∞ø ‡∞™‡∞ü‡±ç‡∞®‡∞Ç)</option>
                                    <option value="Sabbavaram">Sabbavaram (‡∞∏‡∞¨‡±ç‡∞¨‡∞æ‡∞µ‡∞∞‡∞Ç)</option>
                                    <option value="Parawada">Parawada (‡∞™‡∞∞‡∞µ‡∞æ‡∞°)</option>
                                    <option value="Anandapuram">Anandapuram (‡∞Ü‡∞®‡∞Ç‡∞¶‡∞™‡±Å‡∞∞‡∞Ç)</option>
                                </optgroup>
                            </select>
                            <div class="form-text">{{ 'Select the area where your farm/produce is located' if lang == 'en' else '‡∞Æ‡±Ä ‡∞™‡±ä‡∞≤‡∞Ç/‡∞â‡∞§‡±ç‡∞™‡∞§‡±ç‡∞§‡∞ø ‡∞â‡∞®‡±ç‡∞® ‡∞™‡±ç‡∞∞‡∞æ‡∞Ç‡∞§‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø' }}</div>
                        </div>
                        
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle"></i> <strong>{{ 'Note:' if lang == 'en' else '‡∞ó‡∞Æ‡∞®‡∞ø‡∞ï:' }}</strong> 
                            {{ 'Your crop will be visible to all consumers in the marketplace. Make sure all information is accurate.' if lang == 'en' else '‡∞Æ‡±Ä ‡∞™‡∞Ç‡∞ü ‡∞Æ‡∞æ‡∞∞‡±ç‡∞ï‡±Ü‡∞ü‡±ç‚Äå‡∞™‡±ç‡∞≤‡±á‡∞∏‡±ç‚Äå‡∞≤‡±ã ‡∞Ö‡∞Ç‡∞¶‡∞∞‡±Å ‡∞µ‡∞ø‡∞®‡∞ø‡∞Ø‡±ã‡∞ó‡∞¶‡∞æ‡∞∞‡±Å‡∞≤‡∞ï‡±Å ‡∞ï‡∞®‡∞ø‡∞™‡∞ø‡∞∏‡±ç‡∞§‡±Å‡∞Ç‡∞¶‡∞ø. ‡∞Ö‡∞®‡±ç‡∞®‡∞ø ‡∞∏‡∞Æ‡∞æ‡∞ö‡∞æ‡∞∞‡∞Ç ‡∞ñ‡∞ö‡±ç‡∞ö‡∞ø‡∞§‡∞Æ‡±à‡∞®‡∞¶‡∞®‡∞ø ‡∞®‡∞ø‡∞∞‡±ç‡∞ß‡∞æ‡∞∞‡∞ø‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø.' }}
                        </div>
                        
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-success btn-lg">
                                <i class="bi bi-check-circle"></i> {{ 'List Crop' if lang == 'en' else '‡∞™‡∞Ç‡∞ü ‡∞ú‡∞æ‡∞¨‡∞ø‡∞§‡∞æ ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø' }}
                            </button>
                            <a href="{{ url_for('farmer_dashboard') }}" class="btn btn-outline-secondary">
                                <i class="bi bi-arrow-left"></i> {{ 'Back to Dashboard' if lang == 'en' else '‡∞°‡∞æ‡∞∑‡±ç‚Äå‡∞¨‡±ã‡∞∞‡±ç‡∞°‡±ç‚Äå‡∞ï‡±Å ‡∞§‡∞ø‡∞∞‡∞ø‡∞ó‡∞ø ‡∞µ‡±Ü‡∞≥‡±ç‡∞≥‡∞Ç‡∞°‡∞ø' }}
                            </a>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- MSP Reference Card -->
            <div class="card mt-4 border-primary">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">
                        <i class="bi bi-graph-up"></i> {{ 'MSP Reference (2024-25)' if lang == 'en' else 'MSP ‡∞∏‡±Ç‡∞ö‡∞® (2024-25)' }}
                    </h5>
                </div>
                <div class="card-body">
                    <p class="small">{{ 'Minimum Support Prices for major crops:' if lang == 'en' else '‡∞™‡±ç‡∞∞‡∞ß‡∞æ‡∞® ‡∞™‡∞Ç‡∞ü‡∞≤‡∞ï‡±Å ‡∞ï‡∞®‡±Ä‡∞∏ ‡∞Æ‡∞¶‡±ç‡∞¶‡∞§‡±Å ‡∞ß‡∞∞‡∞≤‡±Å:' }}</p>
                    <div class="row g-2">
                        {% for crop in msp_crops[:6] %}
                        <div class="col-md-6">
                            <div class="d-flex justify-content-between align-items-center p-2 bg-light rounded">
                                <span class="fw-bold">{{ crop }}</span>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    <p class="small text-muted mt-3 mb-0">
                        <i class="bi bi-lightbulb"></i> 
                        {{ 'Pricing at or above MSP ensures fair returns for your hard work.' if lang == 'en' else 'MSP ‡∞¶‡∞ó‡±ç‡∞ó‡∞∞ ‡∞≤‡±á‡∞¶‡∞æ ‡∞Ö‡∞Ç‡∞§‡∞ï‡∞Ç‡∞ü‡±á ‡∞é‡∞ï‡±ç‡∞ï‡±Å‡∞µ ‡∞ß‡∞∞ ‡∞™‡±Ü‡∞ü‡±ç‡∞ü‡∞°‡∞Ç ‡∞Æ‡±Ä ‡∞ï‡∞†‡∞ø‡∞® ‡∞∂‡±ç‡∞∞‡∞Æ‡∞ï‡±Å ‡∞®‡±ç‡∞Ø‡∞æ‡∞Ø‡∞Æ‡±à‡∞® ‡∞∞‡∞æ‡∞¨‡∞°‡∞ø‡∞®‡∞ø ‡∞®‡∞ø‡∞∞‡±ç‡∞ß‡∞æ‡∞∞‡∞ø‡∞∏‡±ç‡∞§‡±Å‡∞Ç‡∞¶‡∞ø.' }}
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ENHANCED MSP System with Quantity-Based Calculations -->
<script>
const mspData = {
    'Rice': 2040, 'Wheat': 2125, 'Maize': 1870, 'Tomato': 3000,
    'Onion': 2500, 'Potato': 2800, 'Cotton': 6620, 'Sugarcane': 31500,
    'Groundnut': 5850, 'Soybean': 4600, 'Banana': 3500
};

const lang = '{{ lang }}' || 'en';

console.log('üöÄ Enhanced Quantity-Based MSP System Loading...');

window.addEventListener('load', function() {
    const cropInput = document.getElementById('crop_name');
    const priceInput = document.getElementById('price_per_kg');
    const quantityInput = document.getElementById('quantity');
    const mspAlert = document.getElementById('msp-info-alert');
    const mspText = document.getElementById('msp-info-text');
    const mspCropName = document.getElementById('msp-crop-name');
    const mspQuantityInfo = document.getElementById('msp-quantity-info');
    const warningDiv = document.getElementById('price-warning');
    const totalEarningsDisplay = document.getElementById('total-earnings-display');
    
    if (!cropInput || !priceInput || !quantityInput) {
        console.error('‚ùå Required inputs not found!');
        return;
    }
    
    console.log('‚úÖ All inputs found! System active.');
    
    // Update MSP display when crop or quantity changes
    function updateMSPDisplay() {
        const cropName = cropInput.value.trim();
        const quantity = parseFloat(quantityInput.value) || 0;
        
        if (mspData[cropName]) {
            const mspQuintal = mspData[cropName];
            const mspKg = (mspQuintal / 100).toFixed(2);
            const mspTotalValue = (mspKg * quantity).toFixed(2);
            
            mspCropName.textContent = cropName + (lang === 'te' ? ' MSP ‡∞∏‡∞Æ‡∞æ‡∞ö‡∞æ‡∞∞‡∞Ç' : ' MSP Information');
            mspText.innerHTML = `
                <div class="d-flex gap-3 flex-wrap">
                    <span class="badge bg-success" style="font-size: 1.1rem; padding: 8px 15px;">
                        ‚Çπ${mspQuintal}/quintal
                    </span>
                    <span class="badge bg-primary" style="font-size: 1.1rem; padding: 8px 15px;">
                        ‚Çπ${mspKg}/kg
                    </span>
                </div>
            `;
            
            if (quantity > 0) {
                document.getElementById('farmer-quantity').textContent = quantity;
                document.getElementById('msp-total-value').textContent = `‚Çπ${mspTotalValue}`;
                mspQuantityInfo.style.display = 'block';
            } else {
                mspQuantityInfo.style.display = 'none';
            }
            
            mspAlert.style.display = 'block';
            console.log('‚úÖ MSP shown for:', cropName, 'Quantity:', quantity, 'kg');
            
            // Trigger price check if price exists
            if (priceInput.value) {
                updatePriceWarning();
            }
        } else {
            mspAlert.style.display = 'none';
        }
    }
    
    cropInput.addEventListener('input', updateMSPDisplay);
    quantityInput.addEventListener('input', function() {
        updateMSPDisplay();
        updateTotalEarnings();
    });
    
    // Calculate total earnings
    function updateTotalEarnings() {
        const price = parseFloat(priceInput.value);
        const quantity = parseFloat(quantityInput.value);
        
        if (price && quantity) {
            const total = (price * quantity).toFixed(2);
            document.getElementById('total-earnings-value').textContent = `‚Çπ${total}`;
            document.getElementById('earnings-breakdown').textContent = 
                `‚Çπ${price}/kg √ó ${quantity}kg = ‚Çπ${total}`;
            totalEarningsDisplay.style.display = 'block';
        } else {
            totalEarningsDisplay.style.display = 'none';
        }
    }
    
    priceInput.addEventListener('input', function() {
        updatePriceWarning();
        updateTotalEarnings();
    });
    
    // Real-time price comparison
    function updatePriceWarning() {
        const price = parseFloat(priceInput.value);
        const cropName = cropInput.value.trim();
        const quantity = parseFloat(quantityInput.value) || 0;
        
        if (!price || !mspData[cropName]) {
            warningDiv.innerHTML = '';
            return;
        }
        
        const mspQuintal = mspData[cropName];
        const mspKg = mspQuintal / 100;
        const deficit = (mspKg - price).toFixed(2);
        const percentDiff = ((price - mspKg) / mspKg * 100).toFixed(1);
        
        const farmerTotal = (price * quantity).toFixed(2);
        const mspTotal = (mspKg * quantity).toFixed(2);
        const difference = (farmerTotal - mspTotal).toFixed(2);
        
        if (price < mspKg * 0.95) {
            // BELOW MSP - RED WARNING
            warningDiv.innerHTML = `
                <div class="alert alert-danger border-danger shadow-sm" style="border-width: 3px;">
                    <div class="row align-items-center">
                        <div class="col-auto">
                            <i class="bi bi-exclamation-triangle-fill" style="font-size: 3.5rem; color: #dc3545;"></i>
                        </div>
                        <div class="col">
                            <h5 class="alert-heading mb-2 fw-bold">
                                ${lang === 'te' ? '‚ö†Ô∏è ‡∞π‡±Ü‡∞ö‡±ç‡∞ö‡∞∞‡∞ø‡∞ï: MSP ‡∞ï‡∞Ç‡∞ü‡±á ‡∞§‡∞ï‡±ç‡∞ï‡±Å‡∞µ!' : '‚ö†Ô∏è Warning: Price Below MSP!'}
                            </h5>
                            <div class="row mb-2">
                                <div class="col-6">
                                    <strong>${lang === 'te' ? 'MSP ‡∞ß‡∞∞:' : 'MSP Price:'}</strong> ‚Çπ${mspKg}/kg
                                </div>
                                <div class="col-6">
                                    <strong>${lang === 'te' ? '‡∞Æ‡±Ä ‡∞ß‡∞∞:' : 'Your Price:'}</strong> ‚Çπ${price}/kg
                                </div>
                            </div>
                            ${quantity > 0 ? `
                            <div class="row mb-2">
                                <div class="col-6">
                                    <strong>${lang === 'te' ? 'MSP ‡∞Æ‡±ä‡∞§‡±ç‡∞§‡∞Ç:' : 'MSP Total:'}</strong> ‚Çπ${mspTotal}
                                </div>
                                <div class="col-6">
                                    <strong>${lang === 'te' ? '‡∞Æ‡±Ä ‡∞Æ‡±ä‡∞§‡±ç‡∞§‡∞Ç:' : 'Your Total:'}</strong> ‚Çπ${farmerTotal}
                                </div>
                            </div>
                            <div class="alert alert-light mb-0">
                                <strong>${lang === 'te' ? '‚ö†Ô∏è ‡∞Æ‡±Ä‡∞∞‡±Å ‚Çπ' + Math.abs(difference) + ' ‡∞§‡∞ï‡±ç‡∞ï‡±Å‡∞µ ‡∞∏‡∞Ç‡∞™‡∞æ‡∞¶‡∞ø‡∞∏‡±ç‡∞§‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞∞‡±Å!' : '‚ö†Ô∏è You\'re earning ‚Çπ' + Math.abs(difference) + ' less!'}</strong>
                            </div>
                            ` : ''}
                            <hr class="my-2">
                            <p class="mb-0">
                                <strong>${lang === 'te' 
                                    ? `‡∞Æ‡±Ä‡∞∞‡±Å ‚Çπ${deficit}/kg ‡∞§‡∞ï‡±ç‡∞ï‡±Å‡∞µ‡∞ó‡∞æ ‡∞µ‡∞ø‡∞ï‡±ç‡∞∞‡∞Ø‡∞ø‡∞∏‡±ç‡∞§‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞∞‡±Å`
                                    : `You're selling ‚Çπ${deficit}/kg below MSP`
                                }</strong><br>
                                <small>${lang === 'te' 
                                    ? `‡∞∏‡∞ø‡∞´‡∞æ‡∞∞‡±ç‡∞∏‡±Å: ‚Çπ${mspKg}/kg ‡∞≤‡±á‡∞¶‡∞æ ‡∞Ö‡∞Ç‡∞§‡∞ï‡∞Ç‡∞ü‡±á ‡∞é‡∞ï‡±ç‡∞ï‡±Å‡∞µ`
                                    : `Recommended: ‚Çπ${mspKg}/kg or above`
                                }</small>
                            </p>
                        </div>
                    </div>
                </div>
            `;
        } else if (price > mspKg * 1.2) {
            // ABOVE MSP - YELLOW WARNING
            warningDiv.innerHTML = `
                <div class="alert alert-warning border-warning shadow-sm" style="border-width: 3px;">
                    <div class="row align-items-center">
                        <div class="col-auto">
                            <i class="bi bi-info-circle-fill" style="font-size: 3.5rem; color: #ffc107;"></i>
                        </div>
                        <div class="col">
                            <h5 class="alert-heading mb-2 fw-bold">
                                ${lang === 'te' ? '‚ö†Ô∏è ‡∞ó‡∞Æ‡∞®‡∞ø‡∞ï: MSP ‡∞ï‡∞Ç‡∞ü‡±á ‡∞é‡∞ï‡±ç‡∞ï‡±Å‡∞µ' : '‚ö†Ô∏è Notice: Price Above MSP'}
                            </h5>
                            <div class="row">
                                <div class="col-6">
                                    <strong>MSP:</strong> ‚Çπ${mspKg}/kg
                                </div>
                                <div class="col-6">
                                    <strong>${lang === 'te' ? '‡∞Æ‡±Ä ‡∞ß‡∞∞:' : 'Your Price:'}</strong> ‚Çπ${price}/kg
                                </div>
                            </div>
                            <hr class="my-2">
                            <p class="mb-0">
                                <small>${lang === 'te'
                                    ? `‡∞Æ‡±Ä ‡∞ß‡∞∞ MSP ‡∞ï‡∞Ç‡∞ü‡±á ${Math.abs(percentDiff)}% ‡∞é‡∞ï‡±ç‡∞ï‡±Å‡∞µ. ‡∞á‡∞¶‡∞ø ‡∞µ‡∞ø‡∞ï‡±ç‡∞∞‡∞Ø‡∞ø‡∞Ç‡∞ö‡∞°‡∞Ç ‡∞ï‡∞∑‡±ç‡∞ü‡∞Ç ‡∞ï‡∞æ‡∞µ‡∞ö‡±ç‡∞ö‡±Å.`
                                    : `Your price is ${Math.abs(percentDiff)}% above MSP. This may be harder to sell.`
                                }</small>
                            </p>
                        </div>
                    </div>
                </div>
            `;
        } else {
            // GOOD PRICE - GREEN
            warningDiv.innerHTML = `
                <div class="alert alert-success border-success shadow-sm" style="border-width: 3px;">
                    <div class="row align-items-center">
                        <div class="col-auto">
                            <i class="bi bi-check-circle-fill" style="font-size: 3.5rem; color: #198754;"></i>
                        </div>
                        <div class="col">
                            <h5 class="alert-heading mb-2 fw-bold">
                                ${lang === 'te' ? '‚úì ‡∞Æ‡∞Ç‡∞ö‡∞ø ‡∞ß‡∞∞!' : '‚úì Good Pricing!'}
                            </h5>
                            <div class="row">
                                <div class="col-6">
                                    <strong>MSP:</strong> ‚Çπ${mspKg}/kg
                                </div>
                                <div class="col-6">
                                    <strong>${lang === 'te' ? '‡∞Æ‡±Ä ‡∞ß‡∞∞:' : 'Your Price:'}</strong> ‚Çπ${price}/kg
                                </div>
                            </div>
                            ${quantity > 0 ? `
                            <div class="row mt-2">
                                <div class="col-12">
                                    <div class="alert alert-light mb-0">
                                        <strong>${lang === 'te' ? '‚úì ‡∞Æ‡±Ä ‡∞Æ‡±ä‡∞§‡±ç‡∞§‡∞Ç ‡∞Ü‡∞¶‡∞æ‡∞Ø‡∞Ç: ‚Çπ' + farmerTotal : '‚úì Your Total Earnings: ‚Çπ' + farmerTotal}</strong>
                                    </div>
                                </div>
                            </div>
                            ` : ''}
                            <hr class="my-2">
                            <p class="mb-0">
                                <small>${lang === 'te'
                                    ? '‡∞Æ‡±Ä ‡∞ß‡∞∞ MSP ‡∞™‡∞∞‡∞ø‡∞ß‡∞ø‡∞≤‡±ã ‡∞â‡∞Ç‡∞¶‡∞ø. ‡∞Æ‡∞Ç‡∞ö‡∞ø ‡∞é‡∞Ç‡∞™‡∞ø‡∞ï!'
                                    : 'Your price is within MSP range. Good choice!'
                                }</small>
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }
    }
    
    console.log('‚úÖ Quantity-Based MSP Warning System Active!');
});
</script>
{% endblock %}